# MyPlayerok

Веб-приложение на Symfony 6, ориентированное на PHP 8.1 и СУБД MySQL. Ниже описан быстрый запуск окружения для разработки и набор полезных рекомендаций.

## Быстрый старт

1. Склонируйте репозиторий и перейдите в директорию проекта.
2. Установите зависимости через Composer.
3. Поднимите локальную базу данных и выполните миграции.
4. Запустите встроенный веб-сервер Symfony или PHP.

Подробнее — в разделах ниже.

## Предварительные требования

- PHP >= 8.1 с расширениями `ctype`, `iconv`, `pdo_mysql`.
- Composer 2.x.
- Docker (для локального запуска MySQL).
- Расширение Xdebug по желанию — для отладки и покрытия тестами.

## Настройка переменных окружения

1. Скопируйте файл `.env` в `.env.local` (файл не коммитится) и при необходимости измените параметры подключения к БД:
   ```bash
   cp .env .env.local
   ```
2. Проверьте значение переменной `DATABASE_URL` и подставьте свои логин/пароль и порт.
3. Для тестов можно переопределить `DATABASE_URL` в `.env.test.local`, если требуется отдельная БД.

## База данных

По умолчанию проект рассчитан на MySQL 8. Для быстрого старта поднимите контейнер с помощью Docker:

```bash
docker run --rm \
  --name mysql-myplayerok \
  -e MYSQL_DATABASE=myplayerok \
  -e MYSQL_USER=vokintos \
  -e MYSQL_PASSWORD=111 \
  -e MYSQL_ROOT_PASSWORD=rootpassword \
  -v mysql-data:/var/lib/mysql \
  -p 3307:3306 \
  mysql:8
```

- Подключаться из приложения следует к `127.0.0.1:3307` (обновите `DATABASE_URL`).
- Для остановки контейнера выполните `docker stop mysql-myplayerok` в другом терминале.
- При необходимости почистить данные удалите volume: `docker volume rm mysql-data`.

## Установка зависимостей и миграции

```bash
composer install
php bin/console doctrine:database:create --if-not-exists
php bin/console doctrine:migrations:migrate
```

Команда `doctrine:database:create` создаст БД, если её ещё нет. Миграции расположены в каталоге `migrations/`.

## Запуск приложения для разработки

### Через Symfony CLI (предпочтительно)
```bash
symfony server:start --no-tls
```
Приложение будет доступно на `http://127.0.0.1:8000`. Остановить сервер можно комбинацией `Ctrl+C` или командой `symfony server:stop`.

### Через встроенный PHP-сервер
```bash
php -S 0.0.0.0:8000 -t public/
```

При запуске убедитесь, что директория `public/` указана как корень веб-сервера.

## Тестирование

Запустить модульные тесты можно так:
```bash
php bin/phpunit
```

Для более быстрой итерации используйте режим `--testdox` или запуск отдельных тестовых файлов.

## Полезные команды разработки

- `php bin/console cache:clear` — очистка кеша.
- `php bin/console doctrine:migrations:status` — актуальное состояние миграций.
- `php bin/console debug:router` — список зарегистрированных роутов.
- `php bin/console lint:twig templates/` — проверка шаблонов Twig.
- `composer outdated` — список устаревших зависимостей.

## Рекомендации

- Храните все локальные секреты и пароли в `.env.local`, не коммитьте их в репозиторий.
- Перед коммитом прогоняйте `php bin/phpunit` и проверяйте изменения статическим анализатором при необходимости (например, Psalm или PHPStan).
- Для комфортной разработки установите расширения IDE с поддержкой Symfony (автодополнение для сервисов, Twig и Doctrine).
- Следуйте стандарту кодирования PSR-12 и используйте типы (return types, property types) для повышения надёжности.
- Логи приложения ищите в `var/log/dev.log`; при работе с очередями Doctrine убедитесь, что запущены воркеры `php bin/console messenger:consume async`.

Теперь вы готовы к разработке на проекте MyPlayerok!
